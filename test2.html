<html>
<head>
<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
<!-- スナップインのタグ -->
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"></meta>
</head>
<body>
  <h1>Live Agent サンプル</h1>
  <input type="button" oncick="onChatStarted();" value="start"></input>

<!-- スナップインのタグ #75C1A2 -->
<style type='text/css'>
    .embeddedServiceHelpButton .helpButton .uiButton {
        background-color: #000;
        font-family: "Salesforce Sans", sans-serif;
    }
    .embeddedServiceHelpButton .helpButton .uiButton:focus {
        outline: 1px solid #000;
    }
    @font-face {
        font-family: 'Salesforce Sans';
        src: url('https://www.sfdcstatic.com/system/shared/common/assets/fonts/SalesforceSans/SalesforceSans-Regular.woff') format('woff'),
        url('https://www.sfdcstatic.com/system/shared/common/assets/fonts/SalesforceSans/SalesforceSans-Regular.ttf') format('truetype');
    }
</style>

<script type='text/javascript' src='https://service.force.com/embeddedservice/5.0/esw.min.js'></script>
<script type='text/javascript'>
    var initESW = function(gslbBaseURL) {
        embedded_svc.settings.displayHelpButton = true; //または false
        embedded_svc.settings.language = 'ja'; //たとえば、「en」または「en-US」を入力します

        /* ラベル */
        embedded_svc.settings.defaultMinimizedText = '#チャット受付中';
        embedded_svc.settings.disabledMinimizedText = '#チャット受付停止中';
        embedded_svc.settings.offlineSupportMinimizedText = 'offlineSupportMinimizedText';
        embedded_svc.settings.onlineLoadingText = 'onlineLoadingText';
        // embedded_svc.settings.defaultMinimizedText = '...'; //(エキスパートとチャットにデフォルト設定)
        // embedded_svc.settings.disabledMinimizedText = '...'; //(エージェントがオフラインにデフォルト設定)

        embedded_svc.settings.loadingText = '#ローディング..'; //(読み込み中にデフォルト設定)
        //embedded_svc.settings.storageDomain = 'yourdomain.com'; //(リリースのドメインを設定して、訪問者がチャットセッション中にサブドメインを移動できるようにします)
        
        // 追加
        /*
        embedded_svc.settings.extraPrechatInfo = [{
          "entityFieldMaps": [{
              "doCreate": false,
              "doFind": true,
              "fieldName": "LastName",
              "isExactMatch": true,
              "label": "Last Name"
            }, {
              "doCreate": false,
              "doFind": true,
              "fieldName": "Email",
              "isExactMatch": true,
              "label": "Email"
            }],
            "entityName": "Contact"
          }];
        */
        //
        /*
        embedded_svc.settings.prepopulatedPrechatFields = {
          FirstName: “John”,
          LastName: “Doe”,
          Email: “john.doe@salesforce.com”,
          Subject: “Hello”
        };
        */
        /*
        embedded_svc.settings.extraPrechatFormDetails = [{
            "label": "First Name",
            "value": "John",
            "displayToAgent": true
          }, {
            "label": "Last Name",
            "value": "Doe",
            "displayToAgent": true
          }, {
            "label": "Email",
            "value": "john.doe@salesforce.com",
            "displayToAgent": true
          }
          ];
        
        embedded_svc.settings.extraPrechatInfo = [{
            "entityName": "Contact",
            "showOnCreate": true,
            "linkToEntityName": "Case",
            "linkToEntityField": "ContactId",
            "saveToTranscript": "ContactId",
            "entityFieldMaps": [{
                "isExactMatch": true, "fieldName": "FirstName", "doCreate": true, "doFind": true, "label": "First Name"
              }, {
                "isExactMatch": true, "fieldName": "LastName", "doCreate": true, "doFind": true, "label": "Last Name"
              }, {
                "isExactMatch": true, "fieldName": "Email", "doCreate": true, "doFind": true, "label": "Email"
              }]
          }, {
            "entityName": "Case",
            "showOnCreate": true,
            "saveToTranscript": "CaseId",
            "entityFieldMaps": [{
                "isExactMatch": false, "fieldName": "Subject", "doCreate": true, "doFind": false, "label": "issue"
              }, {
                "isExactMatch": false, "fieldName": "Status", "doCreate": true, "doFind": false, "label": "Status"
              }, {
                "isExactMatch": false, "fieldName": "Origin", "doCreate": true, "doFind": false, "label": "Origin"
              }]
          }];
        */
        /*

        */
        //alert(111);
        // Live Agent の設定
        //embedded_svc.settings.directToButtonRouting = function(prechatFormData) {
            // Dynamically changes the button ID based on what the visitor enters in the pre-chat form.
            // Returns a valid button ID.
        //};
        // embedded_svc.settings.prepopulatedPrechatFields = {}; //事前チャットフォームの項目の自動入力を設定
        // embedded_svc.settings.fallbackRouting = []; //ボタン ID、ユーザ ID、または userId_buttonId の配列
        // embedded_svc.settings.offlineSupportMinimizedText = '...'; //(デフォルトは [Salesforce に問い合わせる])

        embedded_svc.settings.enabledFeatures = ['LiveAgent'];
        embedded_svc.settings.entryFeature = 'LiveAgent';
        
        // embedded_svc.settings.externalStyles = [];
      
        embedded_svc.init(
            'https://cs5.salesforce.com',
            'https://dev05-sbj-community-dev05.cs5.force.com/test2',
            gslbBaseURL,
            '00DO00000055rrt',
            'callcenter_snapin',
            {
                baseLiveAgentContentURL: 'https://c.la1-c1cs-hnd.salesforceliveagent.com/content',
                deploymentId: '572O00000008ONK',
                buttonId: '573O0000000Cavc',
                baseLiveAgentURL: 'https://d.la1-c1cs-hnd.salesforceliveagent.com/chat',
                eswLiveAgentDevName: 'EmbeddedServiceLiveAgent_Parent04IO0000000CaRMMA0_1672573aef2',
                isOfflineSupportEnabled: false
            }
        );
    };

    if (!window.embedded_svc) {
        var s = document.createElement('script');
        s.setAttribute('src', 'https://cs5.salesforce.com/embeddedservice/5.0/esw.min.js');
        s.onload = function() {
            initESW(null);
        };
        document.body.appendChild(s);
    } else {
        initESW('https://service.force.com');
    }
  
    function onChatStarted() {
      alert($('.helpButton .uiButton.helpButtonEnabled').size());
      
    }
</script>

</body>
</html>
